#!/usr/bin/env python
from pirobot import PiRobot
import sys
import readline

cmds = ["speaker_volume", "capture_volume", "motor_switch", "servo_switch", "motor_switch", "power_type"]

p = PiRobot()

def usage(opt = None):
	if opt == None:
		print "Usage: pirobotcmd [option] [control]\n"
		print "    speaker_volume    Control the volume for speaker"
		print "    capture_volume    Control the volume for microphone"
		print "    motor_switch      Switch for motor"
		print "    servo_switch      Switch for servo"
		print "    speaker_switch    Switch for speaker"
		print "    power_type        Change power type for alarm"
	elif opt == "speaker_volume":
		print "Option: Speaker volume:\n\n    Specified a volume in [0, 100]"
	elif opt == "capture_volume":
		print "Option: Capture volume:\n\n    Specified a volume in [0, 100]"
	elif opt == "motor_switch":
		print "Option: Motor Switch:\n\n    Specified a state for motor: 0 = OFF; 1 = ON"
	elif opt == "servo_switch":
		print "Option: Servo Switch:\n\n    Specified a state for servo: 0 = OFF; 1 = ON"
	elif opt == "speaker_switch":
		print "Option: Speaker Switch:\n\n    Specified a state for speaker: 0 = OFF; 1 = ON"
	elif opt == "power_type":
		print 'Option: Power Type:\n\n    Specified a power type: "2S", "3S" Li-po battery or "DC" power'
	quit()

def completer(text, state):
	options = [i for i in cmds if i.startswith(text)]
	if state < len(options):
		return options[state]
	else:
		return None

readline.parse_and_bind("tab: completer")
readline.set_completer(completer)
argv_len = len(sys.argv)

if argv_len < 2:
	usage()
else:
	option = sys.argv[1]

if argv_len < 3:
	usage(option)
else:
	control = sys.argv[2]

if option == 'speaker_volume':
	try:
		control = int(control)
	except:
		usage(option)
	if control not in range(0, 101):
		usage(option)
	p.volume = control
elif option == 'capture_volume':
	try:
		control = int(control)
	except:
		usage(option)
	if control not in range(0, 101):
		usage(option)
	p.capture_volume = control
elif option == 'motor_switch':
	try:
		control = int(control)
	except:
		usage(option)
	if control not in [0, 1]:
		usage(option)
	p.motor_switch(control)
elif option == 'speaker_switch':
	try:
		control = int(control)
	except:
		usage(option)
	if control not in [0, 1]:
		usage(option)
	p.speaker_switch(control)
elif option == 'servo_switch':
	try:
		control = int(control)
	except:
		usage(option)
	if control not in [0, 1]:
		usage(option)
	p.servo_switch(control)
elif option == 'power_type':
	if control not in ['2S', '3S', 'DC']:
		usage(option)
	p.power_type = control